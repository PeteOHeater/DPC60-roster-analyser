<!DOCTYPE html>
<html>
<head>
    <title>Qantas Daily 0.6 Pay Checker</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
        textarea { width: 100%; height: 200px; font-family: monospace; font-size: 12px; margin: 10px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #e21b22; color: white; font-size: 12px; }
        .pay-06 { background-color: #dcfce7 !important; font-weight: bold; border-left: 5px solid #22c55e; }
        .near-miss { background-color: #fef9c3 !important; border-left: 5px solid #eab308; }
        .info { font-size: 0.9em; color: #666; margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="card">
    <h2>Daily Roster Pay Identifier</h2>
    <p class="info">Paste the top section of your roster (the part with "Date Duty(Role) Service...")</p>
    <textarea id="rawInput" placeholder="Paste daily roster here..."></textarea>
    <button onclick="processDaily()" style="width:100%; padding:15px; background:#e21b22; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">Analyze Daily Pay</button>
    <div id="display"></div>
</div>

<script>
function timeToMins(t) {
    if (!t || !t.includes(':')) return 0;
    const [h, m] = t.split(':').map(Number);
    return (h * 60) + m;
}

function minsToTime(m) {
    const h = Math.floor(m / 60);
    const min = Math.round(m % 60);
    return h + ":" + min.toString().padStart(2, '0');
}

function processDaily() {
    const text = document.getElementById('rawInput').value;
    const lines = text.split('\n');
    let html = '<table><tr><th>Date</th><th>Daily Duty</th><th>Daily Credit</th><th>0.6 x Duty</th><th>Status</th></tr>';
    
    // Regex targets: Date (04 Sun) ... Duty (12:10) ... Credit (9:05)
    // It looks for two H:MM strings separated by spaces at the end of the line
    const dailyRegex = /^(\d{2}\s[A-Za-z]{3})\s+.*?\s+(\d{1,2}:\d{2})\s+(\d{1,2}:\d{2})/;

    lines.forEach(line => {
        const match = line.match(dailyRegex);
        if (match) {
            const date = match[1];
            const dutyStr = match[2];
            const credStr = match[3];
            
            const dMins = timeToMins(dutyStr);
            const cMins = timeToMins(credStr);
            const calc06 = dMins * 0.6;
            
            const diff = cMins - calc06;
            const is06Higher = calc06 > cMins;
            const isNear = !is06Higher && diff <= 15; // 15 min threshold

            let rowClass = is06Higher ? 'pay-06' : (isNear ? 'near-miss' : '');
            let status = is06Higher ? 'PAID 0.6 DUTY' : (isNear ? 'Near Miss (' + Math.round(diff) + 'm)' : 'Paid Credit');

            html += `<tr class="${rowClass}">
                <td>${date}</td>
                <td>${dutyStr}</td>
                <td>${credStr}</td>
                <td>${minsToTime(calc06)}</td>
                <td>${status}</td>
            </tr>`;
        }
    });

    document.getElementById('display').innerHTML = html + '</table>';
}
</script>
</body>
</html>
