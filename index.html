<!DOCTYPE html>
<html>
<head>
    <title>Qantas DPC60 Calculator</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 20px; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 950px; margin: auto; }
        h2 { color: #e21b22; margin-top: 0; }
        textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: monospace; box-sizing: border-box; }
        .controls { background: #fff5f5; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #ffcfcf; }
        button { background: #e21b22; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background: #f8f9fa; font-size: 11px; text-transform: uppercase; color: #666; }
        .exact-match { background-color: #dcfce7 !important; font-weight: bold; border-left: 5px solid #22c55e; }
        .near-match { background-color: #fef9c3 !important; border-left: 5px solid #eab308; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; color: white; }
        .bg-green { background: #22c55e; }
        .bg-yellow { background: #eab308; }
    </style>
</head>
<body>
<div class="card">
    <h2>Daily Pay Identifier</h2>
    <div class="controls">
        <label><b>Threshold for "Near DPC60":</b> <span id="tVal">15</span> minutes</label>
        <input type="range" id="threshold" min="1" max="60" value="15" style="width:100%" oninput="document.getElementById('tVal').innerText=this.value">
    </div>
    <textarea id="rosterInput" placeholder="Paste the daily roster section here..."></textarea>
    <button onclick="calculateDaily()">Analyze Daily DPC60</button>
    <div id="results"></div>
</div>

<script>
function toMins(s) {
    if (!s || !s.includes(':')) return 0;
    const [h, m] = s.split(':').map(Number);
    return (h * 60) + m;
}

function toTime(m) {
    const hrs = Math.floor(m / 60);
    const mins = Math.round(m % 60);
    return hrs + ":" + mins.toString().padStart(2, '0');
}

function calculateDaily() {
    const text = document.getElementById('rosterInput').value;
    const threshold = parseInt(document.getElementById('threshold').value);
    const lines = text.split('\n');
    let html = '<table><tr><th>Date</th><th>Daily Duty</th><th>Daily Credit</th><th>0.6 x Duty</th><th>Result Label</th></tr>';
    
    // Pattern to find: Date | Junk | Duty(H:MM) | Credit(H:MM)
    const lineRegex = /^(\d{2}\s[A-Za-z]{3})\s+.*?\s+(\d{1,2}:\d{2})\s+(\d{1,2}:\d{2})/;

    lines.forEach(line => {
        const match = line.match(lineRegex);
        if (match) {
            const date = match[1];
            const dutyMins = toMins(match[2]);
            const creditMins = toMins(match[3]);
            const dpc60 = dutyMins * 0.6;
            
            const diff = Math.abs(creditMins - dpc60);
            let label = "Credit Paid";
            let rowClass = "";

            // User Specific Labeling Requirements
            if (Math.round(dpc60) === creditMins) {
                label = '<span class="badge bg-green">DPC60 = Credit Hours</span>';
                rowClass = "exact-match";
            } else if (diff <= threshold) {
                label = '<span class="badge bg-yellow">Near DPC60</span>';
                rowClass = "near-match";
            }

            html += `<tr class="${rowClass}">
                <td>${date}</td>
                <td>${match[2]}</td>
                <td>${match[3]}</td>
                <td>${toTime(dpc60)}</td>
                <td>${label}</td>
            </tr>`;
        }
    });
    document.getElementById('results').innerHTML = html + '</table>';
}
</script>
</body>
</html>
